<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shop.petpal.admin.mapper.CouponManageMapper">
	<select id="listCoupon" resultType="com.shop.petpal.admin.domain.CouponManage">
	SELECT cp.couponnum,cp.couponName,cp.discountrate,cp.minpayment,cp.validity,cg.categorynum, cg.categoryname
	from coupon cp
	join category cg on cp.categorynum = cg.categorynum
	</select>	
	
	<insert id="insertCoupon" parameterType="com.shop.petpal.admin.domain.CouponManage">
		INSERT INTO coupon (couponNum, couponName, discountRate, minPayment, validity, categoryNum)
		VALUES(coupon_seq.nextval,#{couponName}, #{discountRate}, #{minPayment},#{validity},#{categoryNum})
	</insert>


	<insert id="grantCoupon" parameterType="com.shop.petpal.admin.domain.MemberCoupon">
	INSERT INTO memberCoupon(couponNum, memberNum, regDate, state)
        VALUES( #{couponNum}, #{memberNum}, sysdate, 0 )
	</insert>
	
	<select id="memberExists" parameterType="long" resultType="int">
    	SELECT COUNT(memberNum)
    	FROM member1
    	WHERE memberNum = #{memberNum}
	</select>


	
</mapper>